import{$ as d,$b as u,Md as l,Sc as g,X as f,Xd as b,ad as s,da as a,e as p,ne as m,oe as y}from"./chunk-ZWVAFSUD.js";var $="lab-icon-css",E="lab-theme-css",P=(()=>{class h{document=a(u);store=a(g);themeValues$=new p(1);head=this.document.getElementsByTagName("head")[0];initialize(){this.store.select(y.selectDataset).pipe(f(e=>{let c=this.document.getElementById($);c&&this.head.removeChild(c);let n=this.document.createElement("style");n.id=$;let i="";e.iconIds.forEach(t=>{let r=e.iconEntities[t],o=this.escapeSelector(t);i+=`.${o}::before { background-image: url("${e.iconFile}"); background-position: ${r.position}; } `,r.invertLight&&(i+=`body.light .${o}::before { filter: invert(1); } `,i+=`.invert .${o}::before { filter: invert(1); } `,i+=`body.light .invert .${o}::before { filter: none; } `)}),e.itemIds.map(t=>e.itemEntities[t]).filter(s("icon")).forEach(t=>{let r=e.iconEntities[t.icon],o=this.escapeSelector(t.id);i+=`.${o}.item::before { background-image: url("${e.iconFile}"); background-position: ${r.position}; } `,r.invertLight&&(i+=`body.light .${o}.item::before { filter: invert(1); } `,i+=`.invert .${o}::before { filter: invert(1); } `,i+=`body.light .invert .${o}::before { filter: none; } `)}),e.recipeIds.map(t=>e.recipeEntities[t]).filter(s("icon")).forEach(t=>{let r=e.iconEntities[t.icon],o=this.escapeSelector(t.id);i+=`.${o}.recipe::before { background-image: url("${e.iconFile}"); background-position: ${r.position}; } `,r.invertLight&&(i+=`body.light .${o}.recipe::before { filter: invert(1); } `,i+=`.invert .${o}::before { filter: invert(1); } `,i+=`body.light .invert .${o}::before { filter: none; } `)}),e.categoryIds.map(t=>e.categoryEntities[t]).filter(s("icon")).forEach(t=>{let r=e.iconEntities[t.icon],o=this.escapeSelector(t.id);i+=`.${o}.category::before { background-image: url("${e.iconFile}"); background-position: ${r.position}; } `,r.invertLight&&(i+=`body.light .${o}.category::before { filter: invert(1); } `,i+=`.invert .${o}::before { filter: invert(1); } `,i+=`body.light .invert .${o}::before { filter: none; } `)}),e.itemIds.map(t=>e.itemEntities[t]).filter(s("iconText")).forEach(t=>{let r=this.escapeSelector(t.id);i+=`.${r}.item::after { content: "${t.iconText}"; } `}),e.recipeIds.map(t=>e.recipeEntities[t]).filter(s("iconText")).forEach(t=>{let r=this.escapeSelector(t.id);i+=`.${r}.recipe::after { content: "${t.iconText}"; } `}),e.categoryIds.map(t=>e.categoryEntities[t]).filter(s("iconText")).forEach(t=>{let r=this.escapeSelector(t.id);i+=`.${r}.category::after { content: "${t.iconText}"; } `}),n.innerText=i,this.head.appendChild(n)})).subscribe(),this.store.select(m.selectTheme).pipe(f(e=>{let c=this.document.getElementById(E);if(c){let n=this.themePath(e);if(c.href.endsWith(n))this.updateThemeValues();else{let i=this.document.createElement("link");i.rel="stylesheet",i.href=n,i.onload=()=>{c.href=n,this.head.removeChild(i),this.updateThemeValues()},this.head.appendChild(i)}}for(let n of[l.Light,l.Dark,l.Black])n===e?this.document.body.classList.add(n):this.document.body.classList.remove(n)})).subscribe()}updateThemeValues(){let e=getComputedStyle(this.document.body),c={textColor:e.getPropertyValue("--text-color"),successColor:e.getPropertyValue("--success-color"),successBackground:e.getPropertyValue("--success-background"),dangerColor:e.getPropertyValue("--danger-color"),dangerBackground:e.getPropertyValue("--danger-background")};this.themeValues$.next(c)}themePath(e){switch(e){case l.Light:return"theme-light.css";case l.Black:return"theme-black.css";default:return"theme-dark.css"}}escapeSelector(e){return e.replace(/([^A-Za-z0-9_-])/g,"\\$1")}static appInitTheme(){if((b.preferencesState?.theme??m.initialState.theme)===l.Light){let n=window.document.getElementById(E);n&&(n.href="theme-light.css")}}static \u0275fac=function(c){return new(c||h)};static \u0275prov=d({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();export{P as a};
