import{Bd as k,Dd as r,Hd as I,Ib as d,Ic as y,O as p,S as l,ba as f,nd as h,uc as g}from"./chunk-LVJHIGHJ.js";import{a as b}from"./chunk-TWZW5B45.js";var O=(()=>{let e=class e extends h{constructor(){super(...arguments),this.settingsSvc=l(I),this.itemsState=d(()=>e.computeItemsState(this.state(),this.settingsSvc.settings(),this.settingsSvc.dataset())),this.itemsModified=d(()=>{let i=this.state();return{belts:Object.keys(i).some(o=>i[o].beltId!=null),wagons:Object.keys(i).some(o=>i[o].wagonId!=null)}})}static computeItemsState(i,o,c){let a={};for(let n of c.itemIds.map(t=>c.itemEntities[t])){let t=y(i[n.id]);t.beltId||(n.stack?t.beltId=o.beltId:o.pipeId?t.beltId=o.pipeId:t.beltId=g.Pipe),t.wagonId||(t.wagonId=n.stack?o.cargoWagonId:o.fluidWagonId),a[n.id]=t}return a}};e.\u0275fac=(()=>{let i;return function(c){return(i||(i=f(e)))(c||e)}})(),e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let m=e;return m})();var R=(()=>{let e=class e extends h{constructor(){super(...arguments),this.settingsSvc=l(I),this.machinesState=d(()=>e.computeMachinesState(this.state(),this.settingsSvc.settings(),this.settingsSvc.dataset()))}static computeMachinesState(i,o,c){let a={};for(let n of c.machineIds){let t=b({},i[n]),s=c.machineEntities[n];s.type===k.Burner&&(t.fuelOptions=r.fuelOptions(s,c),t.fuelId=t.fuelId??r.bestMatch(t.fuelOptions.map(u=>u.value),o.fuelRankIds)),s.modules&&(t.moduleOptions=r.moduleOptions(s,c),t.modules=r.hydrateModules(t.modules,t.moduleOptions,o.moduleRankIds,s.modules),t.beacons=r.hydrateBeacons(t.beacons,o.beacons)),t.overclock=t.overclock??o.overclock,a[n]=t}return a}};e.\u0275fac=(()=>{let i;return function(c){return(i||(i=f(e)))(c||e)}})(),e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let m=e;return m})();var Q=(()=>{let e=class e extends h{constructor(){super(...arguments),this.itemsSvc=l(O),this.machinesSvc=l(R),this.settingsSvc=l(I),this.recipesState=d(()=>e.computeRecipesState(this.state(),this.machinesSvc.machinesState(),this.settingsSvc.settings(),this.settingsSvc.dataset())),this.adjustedDataset=d(()=>{let i=this.recipesState(),o=this.itemsSvc.itemsState(),c=this.settingsSvc.availableRecipeIds(),a=this.settingsSvc.settings(),n=this.settingsSvc.dataset();return r.adjustDataset(c,i,o,a,n)}),this.availableItemIds=d(()=>{let i=this.adjustedDataset();return i.itemIds.filter(o=>i.itemRecipeIds[o].length)})}static computeRecipesState(i,o,c,a){let n={};for(let t of a.recipeIds.map(s=>a.recipeEntities[s])){let s=b({},i[t.id]);s.machineId==null&&(s.machineId=r.bestMatch(t.producers,c.machineRankIds));let u=a.machineEntities[s.machineId],S=o[s.machineId];if(t.isBurn?s.fuelId=Object.keys(t.in)[0]:s.fuelId=s.fuelId??S?.fuelId,s.fuelOptions=S?.fuelOptions,u!=null&&r.allowsModules(t,u)?(s.moduleOptions=r.moduleOptions(u,a,t.id),s.modules=r.hydrateModules(s.modules,s.moduleOptions,c.moduleRankIds,u.modules,S.modules),s.beacons=r.hydrateBeacons(s.beacons,S.beacons)):(delete s.modules,delete s.beacons),s.beacons)for(let v of s.beacons)v.total!=null&&(v.count==null||v.count.isZero())&&delete v.total;s.overclock=s.overclock??S?.overclock,n[t.id]=s}return n}};e.\u0275fac=(()=>{let i;return function(c){return(i||(i=f(e)))(c||e)}})(),e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let m=e;return m})();export{O as a,R as b,Q as c};
