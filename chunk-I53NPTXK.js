import{a as ke,c as E,s as qe}from"./chunk-YJ32XG2B.js";import{a as $e,b as Pe,c as We}from"./chunk-VWOD35WD.js";import{$c as Ee,Ac as D,Cd as he,D as Re,Ed as _,Fc as ae,Fd as Ce,G as oe,Gd as Le,Hc as N,Hd as ee,I as W,Ic as le,Jc as Oe,K as q,Kb as H,L as xe,Mc as Fe,O as T,Oc as Z,Pc as A,Qc as x,Rc as g,S as M,Sc as F,Tc as Ne,Uc as O,Vc as K,Wc as Be,Xc as Te,_b as Ae,c as ce,d as be,ed as De,g as Ie,hc as Ve,k as ye,l as G,m as J,pd as Ue,v as je,wc as Y,x as Me,xa as pe,yd as Q,z as we,zc as y}from"./chunk-LVJHIGHJ.js";import{a as ve,j as V}from"./chunk-TWZW5B45.js";var I=function(d){return d.Version0="0",d.Version1="1",d.Version2="2",d.Version3="3",d.Version4="4",d.Version5="5",d.Version6="6",d.Version7="7",d.Version8="8",d.Version9="9",d.Version10="10",d.Version11="11",d}(I||{});var $=(()=>{let S=class S{constructor(){this.base64codes=new Uint8Array(256).fill(255),this.nToId=ae(e=>e/K>=1?this.nToId(Math.floor(e/K))+this.nToId(e%K):O[e]),this.idToN=ae(e=>{let i=Be[e[0]];return e.length>1?(e=e.substring(1),i*Math.pow(K,e.length)+this.idToN(e)):i});for(let e=0;e<O.length;e++)this.base64codes[O.charCodeAt(e)]=e;this.base64codes[95]=0}deflate(e){return V(this,null,function*(){let i=yield this.compress(e,"deflate");return this.bytesToBase64(i)})}inflate(e){return V(this,null,function*(){try{return yield this.inflateStr(e)}catch{console.warn("Router failed to parse url, checking for missing trailing characters...")}try{return yield this.inflateMend(e,"-")}catch{}try{return yield this.inflateMend(e,".")}catch{}return yield this.inflateMend(e,"_")})}inflateMend(e,i){return V(this,null,function*(){let t=yield this.inflateStr(e+i);if(!t)throw new Error("Failed to parse, generated empty string");return console.warn(`Router mended url by appending '${i}'`),t})}inflateStr(e){return this.decompress(this.base64ToBytes(e))}bytesToBase64(e){let i="",t,n=e.length;for(t=2;t<n;t+=3)i+=O[e[t-2]>>2],i+=O[(e[t-2]&3)<<4|e[t-1]>>4],i+=O[(e[t-1]&15)<<2|e[t]>>6],i+=O[e[t]&63];return t===n+1&&(i+=O[e[t-2]>>2],i+=O[(e[t-2]&3)<<4],i+="__"),t===n&&(i+=O[e[t-2]>>2],i+=O[(e[t-2]&3)<<4|e[t-1]>>4],i+=O[(e[t-1]&15)<<2],i+="_"),i}getBase64Code(e){if(e>=this.base64codes.length)throw new Error("Unable to parse base64 string.");let i=this.base64codes[e];if(i===255)throw new Error("Unable to parse base64 string.");return i}base64ToBytes(e){if(e.length%4!==0)throw new Error("Unable to parse base64 string.");let i=e.indexOf("_");if(i!==-1&&i<e.length-2)throw new Error("Unable to parse base64 string.");let t=e.endsWith("__")?2:e.endsWith("_")?1:0,n=e.length,r=new Uint8Array(3*(n/4)),s;for(let o=0,c=0;o<n;o+=4,c+=3)s=this.getBase64Code(e.charCodeAt(o))<<18|this.getBase64Code(e.charCodeAt(o+1))<<12|this.getBase64Code(e.charCodeAt(o+2))<<6|this.getBase64Code(e.charCodeAt(o+3)),r[c]=s>>16,r[c+1]=s>>8&255,r[c+2]=s&255;return r.subarray(0,r.length-t)}compress(e,i="deflate"){return V(this,null,function*(){let t=new TextEncoder().encode(e),n=new CompressionStream(i),r=n.writable.getWriter();r.write(t),r.close();let s=new Response(n.readable).arrayBuffer();return new Uint8Array(yield s)})}decompress(e,i="deflate"){return V(this,null,function*(){let t=new DecompressionStream(i),n=t.writable.getWriter();n.write(e).catch(()=>{}),n.close().catch(()=>{});let r=new Response(t.readable).arrayBuffer();return new TextDecoder().decode(yield r)})}};S.\u0275fac=function(i){return new(i||S)},S.\u0275prov=T({token:S,factory:S.\u0275fac,providedIn:"root"});let d=S;return d})();var He=(()=>{let S=class S{constructor(){this.http=M(Ae),this.datasetsSvc=M(Ce),this.preferencesSvc=M(Ue),this.settingsSvc=M(ee),this.cacheData={},this.cacheI18n={},H(()=>{let e=this.settingsSvc.modId();e!=null&&this.requestData(e).subscribe()}),H(()=>{let e=this.settingsSvc.modId(),i=this.preferencesSvc.language();e==null||i===De.English||this.requestI18n(e,i).subscribe()})}requestData(e){return this.cacheData[e]||(this.cacheData[e]=J([this.http.get(`data/${e}/data.json`),this.http.get(`data/${e}/hash.json`)]).pipe(q(([i,t])=>{this.datasetsSvc.loadData(e,i,t)}),oe())),this.cacheData[e]}requestI18n(e,i){return this.cacheI18n[e]||(this.cacheI18n[e]={}),this.cacheI18n[e][i]||(this.cacheI18n[e][i]=this.http.get(`data/${e}/i18n/${i}.json`).pipe(Me(()=>Ie),q(t=>{this.datasetsSvc.loadI18n(e,i,t)}),oe())),this.cacheI18n[e][i]}};S.\u0275fac=function(i){return new(i||S)},S.\u0275prov=T({token:S,factory:S.\u0275fac,providedIn:"root"});let d=S;return d})();var te=(()=>{let S=class S{constructor(){this.compressionSvc=M($)}zipFields(e){return e.join(g).replace(/\**$/,"")}zipString(e){return e??""}zipRational(e){return e==null?"":e.toString()}zipNumber(e){return e==null?"":e.toString()}zipArray(e){return e==null?"":e.length?e.join(x):A}zipNString(e,i){return e==null?"":this.compressionSvc.nToId(i.indexOf(e))}zipDiffSubset(e,i,t,n=t){if(e==null||i!=null&&Array.from(e).every(p=>i.has(p)))return"";if(e.size===0)return A;let r=new Set(t),s=[],o,c;return n.forEach((p,u)=>{if(r.has(p))if(e.has(p)){let h=this.compressionSvc.nToId(u);o==null?o=h:c=h}else o!=null&&(c==null?s.push(o):s.push(o+x+c),o=void 0,c=void 0)}),o!=null&&(c==null?s.push(o):s.push(o+x+c)),s.join(g)}zipDiffString(e,i,t){return e===i||e==null?"":[e,this.compressionSvc.nToId(t.indexOf(e))]}zipDiffNumber(e,i){return e===i||e==null?"":e.toString()}zipDiffRational(e,i){return e==null||i!=null&&e.eq(i)?"":e.toString()}zipDiffBool(e,i){return e===i?"":e?F:Ne}zipDiffIndices(e,i){let t=e!=null?e.length>0?e.join(x):A:"",n=i!=null?i.length>0?i.join(x):A:"";return t===n?"":t}zipDiffArray(e,i,t){let n=e!=null?e.length>0?e.join(x):A:"",r=i!=null?i.length>0?i.join(x):A:"";return n===r?"":e==null||e.length===0?n:[n,e.map(s=>this.compressionSvc.nToId(t.indexOf(s))).join(x)]}parseString(e,i){if(i!=null)return this.parseNString(e,i);if(e?.length)return e}parseBool(e){if(e?.length)return e===F}parseNumber(e){if(e?.length)return Number(e)}parseRational(e){if(e?.length)return Y(e)}parseArray(e,i){if(i)return this.parseNArray(e,i);if(e?.length)return e===A?[]:e.split(x)}parseIndices(e,i){if(e?.length)return e===A?[]:e.split(x).map(t=>Number(t)).map(t=>i[t]??{})}parseNString(e,i){let t=this.parseString(e);return t==null?t:i[this.compressionSvc.idToN(t)]}parseNArray(e,i){let t=this.parseArray(e);return t==null?t:t.map(n=>i[this.compressionSvc.idToN(n)])}parseSubset(e,i){if(!e?.length)return;if(e===A)return new Set;let t=e.split(g),n=new Set;for(let r of t){let[s,o]=r.split(x).map(u=>this.compressionSvc.idToN(u)),c=o!=null?o+1:s+1;i.slice(s,c).forEach(u=>n.add(u))}return n}set(e,i,t){return n=>(r,s,...o)=>{let c=s(i),p=s(t),u=n(c,p,...o),h,f;Array.isArray(u)?[h,f]=[...u]:h=f=u,h&&(e.bare[r]=h,e.hash[r]=f)}}get(e){return i=>(i=i.bind(this),(t,...n)=>i(e[t],...n))}};S.\u0275fac=function(i){return new(i||S)},S.\u0275prov=T({token:S,factory:S.\u0275fac,providedIn:"root"});let d=S;return d})();var z="_",se="?",a=function(d){return d.Version="v",d.Mod="b",d.Objectives="p",d.RecipeObjectives="q",d.Items="i",d.Recipes="r",d.Machines="f",d.Modules="m",d.Beacons="e",d.Settings="s",d.Zip="z",d}(a||{}),ne=function(d){return d.ExpensiveDeprecation="The expensive setting has been removed. Please use or request an expensive data set instead.",d.LimitStepDeprecation="Limit steps have been replaced by limit objectives. Results may differ if using multiple objectives as limits apply to all objectives.",d}(ne||{}),Ye=(()=>{let S=class S{constructor(){this.analyticsSvc=M(Te),this.compressionSvc=M($),this.contentSvc=M(ke),this.translateSvc=M(Fe),this.zipSvc=M(te)}migrate(e,i){if(Object.keys(i).length===0)return{modId:e??Z,params:{},isBare:!0};i=ve({},i);let t=D(i.v,I.Version0);this.analyticsSvc.event("unzip_version",t);let n=i.z==null;(n||t===I.Version0)&&Object.keys(i).forEach(o=>{Array.isArray(i[o])?i[o]=i[o].map(c=>decodeURIComponent(c)):i[o]&&(i[o]=decodeURIComponent(i[o]))});let r=this.migrateAny(e,i,n,t);return this.displayWarnings(r.warnings),["o","i","r","m","e","b"].forEach(o=>{let c=r.params[o];typeof c=="string"&&(r.params[o]=[c])}),{modId:r.modId,params:r.params,isBare:r.isBare}}migrateAny(e,i,t,n){let s={modId:e,params:i,warnings:[],isBare:t};switch(n){case I.Version0:return this.migrateV0(s);case I.Version1:return this.migrateV1(s);case I.Version2:return this.migrateV2(s);case I.Version3:return this.migrateV3(s);case I.Version4:return this.migrateV4(s);case I.Version5:return this.migrateV5(s);case I.Version6:return this.migrateV6(s);case I.Version7:return this.migrateV7(s);case I.Version8:return this.migrateV8(s);case I.Version9:return this.migrateV9(s);case I.Version10:return this.migrateV10(s);default:return s}}migrateV0(e){let{params:i}=e;if(i[a.Settings]){let n=y(i[a.Settings]).split(g),r=this.zipSvc.parseString(n[0]);r=r&&_.modHash[_.modHashV0.indexOf(r)],r=r??"";let s=this.zipSvc.parseNumber(n[6])??60,o=s===1?"0":s===3600?"2":"1";i[a.Settings]=this.zipSvc.zipFields([r,o,y(i[a.Mod]),n[1],n[3],n[4],n[5],n[7],n[8],n[10],n[9],n[2],n[11],n[12]])}else i[a.Mod]&&(i[a.Settings]=this.zipSvc.zipFields([se,se,y(i[a.Mod])]));return delete i[a.Mod],i[a.Version]=I.Version1,this.migrateV1(e)}migrateV1(e){let{params:i,warnings:t}=e;if(i[a.Settings]){let r=y(i[a.Settings]).split(g),s=11;if(r.length>s){let o=r.splice(s,1);this.zipSvc.parseBool(o[0])&&t.push(ne.ExpensiveDeprecation)}i[a.Settings]=this.zipSvc.zipFields(r)}return i[a.Version]=I.Version4,this.migrateV4(e)}migrateV2(e){let{params:i}=e;if(i[a.Recipes]){let n=y(i[a.Recipes]).split(z),r=[],s=3;for(let o of n){let c=o.split(g);if(c.length>s){let p=this.parseNNumber(c[s])?.toString();c[s]=this.zipSvc.zipString(p)}r.push(this.zipSvc.zipFields(c))}i[a.Recipes]=r.join(z)}if(i[a.Machines]){let n=y(i[a.Machines]).split(z),r=[],s=2;for(let o of n){let c=o.split(g);if(c.length>s){let p=this.parseNNumber(c[s])?.toString();c[s]=this.zipSvc.zipString(p)}r.push(this.zipSvc.zipFields(c))}i[a.Machines]=r.join(z)}return i[a.Version]=I.Version3,this.migrateV3(e)}migrateV3(e){let{params:i,warnings:t}=e;if(i[a.Settings]){let r=y(i[a.Settings]).split(g),s=10;if(r.length>s){let o=r.splice(s,1);this.zipSvc.parseBool(o[0])&&t.push(ne.ExpensiveDeprecation)}i[a.Settings]=this.zipSvc.zipFields(r)}return i[a.Version]=I.Version5,this.migrateV5(e)}migrateInlineBeaconsSection(e,i,t,n){if(e[i]){let s=y(e[i]).split(z),o=[];for(let c of s.map(p=>p.split(g))){let p=t+1,u=p+1,h=u+3;if(c.length>t){let f,m,w;c.length>h&&(w=c.splice(h,1)[0]),c.length>u&&(f=c.splice(u,1)[0]),c.length>p&&(m=c.splice(p,1)[0]);let l=c[t];c[t]=this.zipSvc.zipArray([n.length]),n.push(this.zipSvc.zipFields([l,this.zipSvc.zipString(m),this.zipSvc.zipString(f),this.zipSvc.zipString(w)]))}o.push(this.zipSvc.zipFields(c))}e[i]=o.join(z)}}migrateInlineBeacons(e){let i=[];return this.migrateInlineBeaconsSection(e.params,a.RecipeObjectives,4,i),this.migrateInlineBeaconsSection(e.params,a.Recipes,3,i),i.length&&(e.params[a.Beacons]=i.join(z)),e}migrateV4(e){return e=this.migrateInlineBeacons(e),e.params[a.Version]=I.Version6,this.migrateV6(e)}migrateV5(e){return e=this.migrateInlineBeacons(e),e.params[a.Version]=I.Version7,this.migrateV7(e)}migrateInsertField(e,i,t){if(e[i]){let n=y(e[i]).split(z);for(let r=0;r<n.length;r++){let s=n[r].split(g);s.length>t&&(s.splice(t,0,""),n[r]=this.zipSvc.zipFields(s))}e[i]=n.join(z)}}migrateDeleteField(e,i,t){if(e[i]){let n=y(e[i]).split(z);for(let r=0;r<n.length;r++){let s=n[r].split(g);s.length>t&&(s.splice(t,1),n[r]=this.zipSvc.zipFields(s))}e[i]=n.join(z)}}migrateMoveUpField(e,i,t){if(e[i]!=null){let n=e[i];for(e.splice(i,1),e.length>t&&e.splice(t,0,"");e.length<=t;)e.push("");e[t]=n}}migrateToV8(e){let{params:i,isBare:t}=e,n=!1;if(this.migrateInsertField(i,a.RecipeObjectives,2),i[a.Objectives]){let r=y(i[a.Objectives]).split(z),s=[...r];for(let o=0;o<r.length;o++){let p=r[o].split(g);if(p[2]==="3")if(t){let u=i[a.RecipeObjectives]?y(i[a.RecipeObjectives]).split(z):[];if(p.length>3){let h=[p[3],p[1],E.Limit.toString()],f=[p[0],"1",E.Maximize.toString()];u.push(this.zipSvc.zipFields(f)),u.push(this.zipSvc.zipFields(h)),n=!0}else u.push(this.zipSvc.zipFields([p[0],p[1]]));s.splice(o,1),i[a.RecipeObjectives]=u.join(z)}else p[2]="0",s[o]=this.zipSvc.zipFields(p);else if(p.length>3){let u=[p[3],p[1],p[2],E.Limit.toString()],h=[p[0],"1","",E.Maximize.toString()];s[o]=this.zipSvc.zipFields(h),s.push(this.zipSvc.zipFields(u)),n=!0}}n&&e.warnings.push(ne.LimitStepDeprecation),i[a.Objectives]=s.join(z)}if(this.migrateDeleteField(i,a.Items,4),this.migrateInsertField(i,a.Recipes,1),i[a.Settings]){let r=y(i[a.Settings]).split(g),s=t?1:0;if(r.length>2+s){let o=this.zipSvc.parseArray(r[2+s]);if(o){let c=y(i[a.Recipes]),p=c?c.split(z):[];for(let u of o){let h=!1;for(let f=0;f<p.length;f++){let m=p[f].split(g);m[0]===u&&(h=!0,m[1]=F,p[f]=this.zipSvc.zipFields(m))}h||p.push(this.zipSvc.zipFields([u,F]))}i[a.Recipes]=p.join(z)}r.splice(2+s,1)}r.splice(s,0,""),this.migrateMoveUpField(r,16+s,20+s),this.migrateMoveUpField(r,15+s,19+s),this.migrateMoveUpField(r,14+s,18+s),this.migrateMoveUpField(r,13+s,17+s),i[a.Settings]=this.zipSvc.zipFields(r)}return i[a.Version]=I.Version8,e}migrateV6(e){return e.isBare=!0,this.migrateV8(this.migrateToV8(e))}migrateV7(e){return e.isBare=!1,this.migrateV8(this.migrateToV8(e))}migrateV8(e){let{params:i}=e;if(i[a.RecipeObjectives]){let t=[];i[a.Objectives]&&(t=y(i[a.Objectives]).split(z));let n=y(i[a.RecipeObjectives]).split(z);for(let r of n){let s=r.split(g),o=this.zipSvc.zipFields([s[0],s[1],"3",s[2],s[3],s[4],s[5],s[6],s[7]]);t.push(o)}i[a.RecipeObjectives]="",i[a.Objectives]=t.join(z)}return this.migrateV9(e)}migrateInlineModulesSection(e,i,t,n){if(e[i]){let s=y(e[i]).split(z),o=[];for(let c of s.map(p=>p.split(g))){if(c.length>t){let p=c[t],u=this.zipSvc.parseArray(p);if(u==null)continue;let h=new Map;for(let m of u){let w=h.get(m)??0;h.set(m,w+1)}let f=Array.from(h.keys()).map((m,w)=>n.length+w);c[t]=this.zipSvc.zipArray(f);for(let m of h.keys())n.push(this.zipSvc.zipFields([D(h.get(m)?.toString(),""),m]))}o.push(this.zipSvc.zipFields(c))}e[i]=o.join(z)}}migrateV9(e){let{params:i}=e,t=[];if(this.migrateInlineModulesSection(e.params,a.Beacons,1,t),this.migrateInlineModulesSection(e.params,a.Recipes,3,t),this.migrateInlineModulesSection(e.params,a.Objectives,5,t),e.params[a.Machines]){let r=y(i[a.Machines]).split(z),s=[],o=e.params[a.Beacons]?y(e.params[a.Beacons]).split(z):[],c=2,p=c+1,u=p+1;r.map(h=>h.split(g)).forEach((h,f)=>{if(f===0&&h[0]===F&&(h[0]=A),this.migrateMoveUpField(h,5,6),h[0]!==A&&h[0]!==""&&h.length>1){let m=h[1];if(m){let w=m.split(x)[0];h[1]=this.zipSvc.zipArray([t.length]),t.push(this.zipSvc.zipFields(["",w]))}}if(h.length>2){let m,w;if(h.length>u&&(m=h.splice(u,1)[0]),h.length>p){let j=h.splice(p,1)[0];if(j){let B=j.split(x)[0];w=[t.length],t.push(this.zipSvc.zipFields(["",B]))}}let l=h[c];h[c]=this.zipSvc.zipArray([o.length]),o.push(this.zipSvc.zipFields([l,this.zipSvc.zipArray(w),this.zipSvc.zipString(m)]))}s.push(this.zipSvc.zipFields(h))}),o.length&&(e.params[a.Beacons]=o.join(z)),e.params[a.Machines]=s.join(z)}if(t.length&&(e.params[a.Modules]=t.join(z)),i[a.Settings]){let n=y(i[a.Settings]).split(g),r=e.isBare?5:4;if(n.length>r){let s=n.splice(r,1)[0];if(i[a.Machines]){let o=y(i[a.Machines]).split(z).map(p=>p.split(g)),c=o.find(p=>p[0]===A||p[0]==="");if(c){for(;c.length<4;)c.push("");c[3]=s}else o.unshift(["","","",s]);i[a.Machines]=o.map(p=>this.zipSvc.zipFields(p)).join(z)}else i[a.Machines]=["","","",s].join(g);i[a.Settings]=n.join(g)}}return i[a.Version]=I.Version10,this.migrateV10(e)}migrateV10(e){let{params:i}=e;delete i[a.RecipeObjectives];let t=new Set,n=new Set,r=new Set,s=new Set,o=new Set;function c(b,v){v.size!==0&&(i[b]=Array.from(v).join(x))}let p=i[a.Modules];delete i[a.Modules];let u=p?.split(z),h=i[a.Beacons];delete i[a.Beacons];let f=h?.split(z),m=i[a.Objectives];delete i[a.Objectives];let w=[],l=m?.split(z).map((b,v)=>{let R=b.split(g),C=v.toString();return w.push(C),R[8]===F&&t.add(C),R.splice(8,1),R.join(g)}).filter(b=>b);l?.length&&(i.o=l),t.size&&(i.och=this.zipSvc.zipDiffSubset(t,void 0,w));let j=i[a.Items];delete i[a.Items];let B=j?.split(z).map(b=>{let v=b.split(g),R=v[0];return v[1]===F&&n.add(R),v[4]===F&&r.add(R),v.splice(4,1),v.splice(1,1),v.join(g)}).filter(b=>b);B?.length&&(i.i=B),c("v10iex",n),c("v10ich",r);let k=i[a.Recipes];delete i[a.Recipes];let U=k?.split(z).map(b=>{let v=b.split(g),R=v[0];return v[1]===F&&s.add(R),v[7]===F&&o.add(R),v.splice(7,1),v.splice(1,1),v.join(g)}).filter(b=>b);U?.length&&(i.r=U),c("v10rex",s),c("v10rch",o);let Ke=i[a.Machines];delete i[a.Machines];let X,ue,de,fe,me,re=[];Ke?.split(z).forEach((b,v)=>{let R=b.split(g),C=R[0];v===0?(C===A&&(X=[]),de=R[1],fe=R[2],ue=R[3],me=R[4]):(X?.push(C),R.length>1&&re.push(b))}),re.length&&(i.m=re),i.mmr=X?.join(x),i.mfr=ue,i.mer=de,i.mbe=fe,i.moc=me;let Se=i[a.Settings];if(delete i[a.Settings],Se){let b=Se.split(g),v=e.isBare?b.splice(0,1)[0]:void 0;v&&(e.modId=v);let R=b[0];R&&R!==se&&c("v10tre",new Set(R.split(x))),["odr","mpr","ibe","ifr","bmi","bre","bic","mit","icw","ifw","ipi","mbr","mps","rnp","omt","cfa","cma","cun","cex","csu","cmx","osm","cfp"].forEach((ze,L)=>{i[ze]=b[L+1]||void 0}),e.isBare||["ifr","bmi","bre","omt"].filter(L=>i[L]!=null).forEach(L=>{i[L]=this.parseNNumber(y(i[L]))?.toString()})}let Qe=i[a.Mod];delete i[a.Mod];let P=Qe;P&&!e.isBare&&(P=_.modHash[this.compressionSvc.idToN(P)]),P&&(e.modId=P),i.e=u,i.b=f,i.v=I.Version11,N(i);function ge(b){return b.replaceAll(se,"").replaceAll(A,A)}return Object.keys(i).forEach(b=>{let v=i[b];Array.isArray(v)?i[b]=v.map(R=>ge(R)):v&&(i[b]=ge(v))}),e}restoreV10ResearchedTechnologies(e,i){let t=i.items.filter(c=>c.technology),n=t.map(c=>c.id);if(e==null||!n.length)return;let r=new Set(e),s=Oe(t),o;do{o=new Set;for(let c of r)s[c].technology?.prerequisites?.filter(u=>!r.has(u)).forEach(u=>o.add(u));o.forEach(c=>r.add(c))}while(o.size);if(r.size!==n.length)return r}parseNNumber(e){if(e?.length)return this.compressionSvc.idToN(e)}parseSet(e,i){if(e==null)return;let t=e.split(x);return i==null?new Set(t):new Set(t.map(n=>i[this.compressionSvc.idToN(n)]))}displayWarnings(e){this.translateSvc.multi(["app.migrationWarning","OK"]).pipe(Re()).subscribe(([i,t])=>{for(let n of e)this.contentSvc.confirm({message:n,header:i,acceptLabel:t,rejectVisible:!1})})}};S.\u0275fac=function(i){return new(i||S)},S.\u0275prov=T({token:S,factory:S.\u0275fac,providedIn:"root"});let d=S;return d})();var Zi=(()=>{let S=class S{get empty(){return{bare:{},hash:{}}}get emptyRecipeSettingsInfo(){return{idMap:{},list:[]}}get emptyMachineSettings(){return{moduleMap:{},beaconMap:{}}}constructor(){this.router=M(Ve),this.compressionSvc=M($),this.dataSvc=M(He),this.itemsSvc=M($e),this.machinesSvc=M(Pe),this.migrationSvc=M(Ye),this.objectivesSvc=M(qe),this.recipesSvc=M(We),this.settingsSvc=M(ee),this.zipSvc=M(te),this.zipState$=new ce,this.zipConfig=pe(this.empty),this.version=I.Version11,this.zipTail={v:this.version},this.route$=new ce,this.ready=pe(!1),this.navigating$=new be(!1),this.stored=Ee("router"),this.route$.pipe(W(e=>J({params:e.params,queryParams:e.queryParams})),xe(this.navigating$),je(([e,i])=>!i),G(([e])=>e),W(t=>V(this,[t],function*({params:e,queryParams:i}){return i=yield this.unzipQueryParams(i),{params:e,queryParams:i}})),G(({params:e,queryParams:i})=>this.migrationSvc.migrate(e.id,i)),W(({modId:e,params:i,isBare:t})=>this.updateState(e,i,t))).subscribe(),H(()=>{let e=this.ready(),i=this.settingsSvc.hash();if(!e||!i)return;let t=this.objectivesSvc.state(),n=this.itemsSvc.state(),r=this.recipesSvc.state(),s=this.machinesSvc.state(),o=this.settingsSvc.state(),c=this.settingsSvc.dataset();this.zipState$.next({objectives:t,items:n,recipes:r,machines:s,settings:o,data:c,hash:i})}),this.zipState$.pipe(we(0),G(e=>this.zipState(e)),q(e=>{this.zipConfig.set(e.config)}),W(e=>this.updateUrl(e))).subscribe()}updateUrl(e){return V(this,null,function*(){let i=yield this.getHash(e);this.navigating$.next(!0),yield this.router.navigate([],{queryParams:i}),this.navigating$.next(!1);let t=this.router.url,n=t.split("?")[0];(n.endsWith("list")||n.endsWith("flow"))&&this.stored.set(t)})}zipState(e){let{objectives:i,items:t,recipes:n,machines:r,settings:s,data:o,hash:c}=e,p=this.zipModulesBeacons(i,n,r,s,c);return this.zipObjectives(p,i,c),this.zipItems(p,t,c),this.zipRecipes(p,n,c),this.zipMachines(p,r,c),this.zipSettings(p,s,Object.keys(i),o,c),p}stepHref(e,i,t){return V(this,null,function*(){if(t==null)return null;let n;if(e.itemId!=null&&e.items!=null?n={1:{id:"1",targetId:e.itemId,value:e.items,unit:Q.Items,type:E.Output}}:e.recipeId!=null&&e.machines!=null&&(n={1:{id:"1",targetId:e.recipeId,value:e.machines,unit:Q.Machines,type:E.Output}}),n==null)return null;let r={objectives:this.empty,config:i,objectiveSettings:this.emptyMachineSettings,recipeSettings:this.emptyMachineSettings,machineSettings:this.emptyMachineSettings};return this.zipObjectives(r,n,t),yield this.getHash(r)})}getHash(e){return V(this,null,function*(){let i=le(e.objectives.bare,e.config.bare,this.zipTail),t=le(e.objectives.hash,e.config.hash,this.zipTail),n=this.toString(t),s={z:yield this.compressionSvc.deflate(n),v:this.version},c=this.toString(i).length,u=this.toString(s).length;return c<Math.max(u,200)?i:s})}toParams(e){let i=e.split("&");return i.some(t=>!t.includes("="))?i.reduce((t,n)=>(t[n[0]]=n.substring(1),t),{}):i.reduce((t,n)=>{let[r,s]=n.split("=");return t[r]=s,t},{})}toString(e){return Object.keys(e).flatMap(i=>{let t=e[i];return Array.isArray(t)?t.map(n=>`${i}=${n}`):t?`${i}=${t}`:[]},"").join("&")}unzipQueryParams(e){return V(this,null,function*(){let i=e.z;if(i!=null)try{let t=y(i).replace(/\+/g,"-").replace(/\//g,".").replace(/=/g,"_"),n=yield this.compressionSvc.inflate(t);e=this.toParams(n),e.z=i}catch(t){throw console.error(t),new Error("RouterService failed to parse url")}return e})}updateState(e,i,t){return V(this,null,function*(){if(e==null&&Object.keys(i).length===0){this.ready.set(!0);return}let[n,r]=yield ye(this.dataSvc.requestData(e??Z)),s=t?void 0:r,o=this.unzipModules(i,s),c=this.unzipBeacons(i,o,s),p={};p.objectivesState=this.unzipObjectives(i,o,c,s),p.itemsState=this.unzipItems(i,s),p.recipesState=this.unzipRecipes(i,o,c,s),p.machinesState=this.unzipMachines(i,o,c,s);let u=p.objectivesState?Object.keys(p.objectivesState):[];p.settingsState=this.unzipSettings(e,i,c,u,n,r,s),this.dispatch(p)})}dispatch(e){this.objectivesSvc.load(e.objectivesState),this.itemsSvc.load(e.itemsState),this.recipesSvc.load(e.recipesState),this.machinesSvc.load(e.machinesState),this.settingsSvc.load(e.settingsState),this.ready.set(!0)}zipModulesBeacons(e,i,t,n,r){let s=this.emptyRecipeSettingsInfo,o=this.emptyRecipeSettingsInfo,c=j=>this.zipMachineSettings(j,s,o,r),p=c(e),u=c(i),h=c(t),f;if(n.beacons){let j=this.beaconModuleMap(n.beacons,s,r);f=this.zipBeaconArray(n.beacons,j,o,r)}let m=this.empty,w=["bare","hash"];return[["e",s.list],["b",o.list]].forEach(([j,B])=>{B.forEach(k=>{w.forEach(U=>{m[U][j]==null?m[U][j]=[k[U]]:m[U][j].push(k[U])})})}),{objectives:this.empty,config:m,objectiveSettings:p,recipeSettings:u,machineSettings:h,beacons:f}}zipMachineSettings(e,i,t,n){let r=this.emptyMachineSettings;for(let s of Object.keys(e)){let o=e[s];if(o.modules!=null&&(r.moduleMap[s]=this.zipModuleArray(o.modules,i,n)),o.beacons!=null){let c=this.beaconModuleMap(o.beacons,i,n);r.beaconMap[s]=this.zipBeaconArray(o.beacons,c,t,n)}}return r}beaconModuleMap(e,i,t){return e.map(n=>{if(n.modules!=null)return this.zipModuleArray(n.modules,i,t)})}zipModuleArray(e,i,t){return e.map(n=>{let r=this.zipSvc.zipRational(n.count),s={bare:this.zipSvc.zipFields([r,this.zipSvc.zipString(n.id)]),hash:this.zipSvc.zipFields([r,this.zipSvc.zipNString(n.id,t.modules)])};return i.idMap[s.bare]==null&&(i.idMap[s.bare]=i.list.length,i.list.push(s)),i.idMap[s.bare]})}unzipModules(e,i){return e.e==null?[]:e.e.map(t=>{let n=t.split(g),r=0,s={count:this.zipSvc.parseRational(n[r++]),id:this.zipSvc.parseString(n[r++],i?.modules)};return N(s),s})}zipBeaconArray(e,i,t,n){return e.map((r,s)=>{let o=this.zipSvc.zipRational(r.count),c=this.zipSvc.zipArray(i[s]),p=this.zipSvc.zipRational(r.total),u={bare:this.zipSvc.zipFields([o,c,this.zipSvc.zipString(r.id),p]),hash:this.zipSvc.zipFields([o,c,this.zipSvc.zipNString(r.id,n.beacons),p])};return t.idMap[u.bare]==null&&(t.idMap[u.bare]=t.list.length,t.list.push(u)),t.idMap[u.bare]})}unzipBeacons(e,i,t){return e.b==null?[]:e.b.map(n=>{let r=n.split(g),s=0,o={count:this.zipSvc.parseRational(r[s++]),modules:this.zipSvc.parseIndices(r[s++],i),id:this.zipSvc.parseString(r[s++],t?.beacons),total:this.zipSvc.parseRational(r[s++])};return N(o),o})}zipObjectives(e,i,t){let n=Object.keys(i);if(!n.length)return;let r=n.map(s=>i[s]);e.objectives.bare.o=[],e.objectives.hash.o=[];for(let s of r){let o=this.zipSvc.zipDiffRational(s.value,Y.one),c=this.zipSvc.zipDiffNumber(s.unit,Q.Items),p=this.zipSvc.zipDiffNumber(s.type,E.Output),u=this.zipSvc.zipArray(e.objectiveSettings.moduleMap[s.id]),h=this.zipSvc.zipArray(e.objectiveSettings.beaconMap[s.id]),f=this.zipSvc.zipNumber(s.overclock);e.objectives.bare.o.push(this.zipSvc.zipFields([s.targetId,o,c,p,this.zipSvc.zipString(s.machineId),u,h,f,this.zipSvc.zipString(s.fuelId)])),e.objectives.hash.o.push(this.zipSvc.zipFields([this.zipSvc.zipNString(s.targetId,he(s)?t.recipes:t.items),o,c,p,this.zipSvc.zipNString(s.machineId,t.machines),u,h,f,this.zipSvc.zipNString(s.fuelId,t.fuels)]))}}unzipObjectives(e,i,t,n){if(e.o==null)return;let r={},s=1;for(let o of e.o){let c=o.split(g),p=0,u=s.toString(),h={id:s.toString(),targetId:c[p++],value:D(this.zipSvc.parseRational(c[p++]),Y.one),unit:this.zipSvc.parseNumber(c[p++])??Q.Items,type:this.zipSvc.parseNumber(c[p++])??E.Output,machineId:this.zipSvc.parseString(c[p++],n?.machines),modules:this.zipSvc.parseIndices(c[p++],i),beacons:this.zipSvc.parseIndices(c[p++],t),overclock:this.zipSvc.parseRational(c[p++]),fuelId:this.zipSvc.parseString(c[p++],n?.fuels)};n&&(h.targetId=D(this.zipSvc.parseNString(h.targetId,he(h)?n.recipes:n.items),"")),N(h),r[u]=h,s++}return r}zipItems(e,i,t){let n=Object.keys(i);if(n.length){e.config.bare.i=[],e.config.hash.i=[];for(let r of n){let s=i[r];e.config.bare.i.push(this.zipSvc.zipFields([r,this.zipSvc.zipString(s.beltId),this.zipSvc.zipString(s.wagonId)])),e.config.hash.i.push(this.zipSvc.zipFields([this.zipSvc.zipNString(r,t.items),this.zipSvc.zipNString(s.beltId,t.belts),this.zipSvc.zipNString(s.wagonId,t.wagons)]))}}}unzipItems(e,i){if(e.i==null)return;let t={};for(let n of e.i){let r=n.split(g),s=0,o=D(this.zipSvc.parseString(r[s++],i?.items),""),c={beltId:this.zipSvc.parseString(r[s++],i?.belts),wagonId:this.zipSvc.parseString(r[s++],i?.wagons)};N(c),Object.keys(c).length&&(t[o]=c)}return t}zipRecipes(e,i,t){let n=Object.keys(i);if(n.length){e.config.bare.r=[],e.config.hash.r=[];for(let r of n){let s=i[r],o=this.zipSvc.zipArray(e.recipeSettings.moduleMap[r]),c=this.zipSvc.zipArray(e.recipeSettings.beaconMap[r]),p=this.zipSvc.zipNumber(s.overclock),u=this.zipSvc.zipNumber(s.cost);e.config.bare.r.push(this.zipSvc.zipFields([r,this.zipSvc.zipString(s.machineId),o,c,p,u,this.zipSvc.zipString(s.fuelId)])),e.config.hash.r.push(this.zipSvc.zipFields([this.zipSvc.zipNString(r,t.recipes),this.zipSvc.zipNString(s.machineId,t.machines),o,c,p,u,this.zipSvc.zipNString(s.fuelId,t.fuels)]))}}}unzipRecipes(e,i,t,n){if(e.r==null)return;let r={};for(let s of e.r){let o=s.split(g),c=0,p=D(this.zipSvc.parseString(o[c++],n?.recipes),""),u={machineId:this.zipSvc.parseString(o[c++],n?.machines),modules:this.zipSvc.parseArray(o[c++])?.map(h=>i[Number(h)]??{}),beacons:this.zipSvc.parseArray(o[c++])?.map(h=>t[Number(h)]??{}),overclock:this.zipSvc.parseRational(o[c++]),cost:this.zipSvc.parseRational(o[c++]),fuelId:this.zipSvc.parseString(o[c++],n?.fuels)};N(u),Object.keys(u).length&&(r[p]=u)}return r}zipMachines(e,i,t){let n=Object.keys(i);if(n.length){e.config.bare.m=[],e.config.hash.m=[];for(let r of n){let s=i[r],o=this.zipSvc.zipArray(e.machineSettings.moduleMap[r]),c=this.zipSvc.zipArray(e.machineSettings.beaconMap[r]),p=this.zipSvc.zipNumber(s.overclock);e.config.bare.m.push(this.zipSvc.zipFields([r,o,c,this.zipSvc.zipString(s.fuelId),p])),e.config.hash.m.push(this.zipSvc.zipFields([this.zipSvc.zipNString(r,t.machines),o,c,this.zipSvc.zipNString(s.fuelId,t.fuels),p]))}}}unzipMachines(e,i,t,n){if(e.m==null)return;let r={};for(let s of e.m){let o=s.split(g),c=0,p=D(this.zipSvc.parseString(o[c++],n?.machines),""),u={modules:this.zipSvc.parseArray(o[c++])?.map(h=>i[Number(h)]??{}),beacons:this.zipSvc.parseArray(o[c++])?.map(h=>t[Number(h)]??{}),fuelId:this.zipSvc.parseString(o[c++],n?.fuels),overclock:this.zipSvc.parseRational(o[c++])};N(u),Object.keys(u).length&&(r[p]=u)}return r}zipSettings(e,i,t,n,r){let s=Le,o=this.zipSvc.set(e.config,i,s),c=o(this.zipSvc.zipDiffSubset.bind(this.zipSvc)),p=o(this.zipSvc.zipDiffNumber.bind(this.zipSvc)),u=o(this.zipSvc.zipDiffBool.bind(this.zipSvc)),h=o(this.zipSvc.zipDiffString.bind(this.zipSvc)),f=o(this.zipSvc.zipDiffRational.bind(this.zipSvc)),m=o(this.zipSvc.zipDiffArray.bind(this.zipSvc)),w=o(this.zipSvc.zipDiffIndices.bind(this.zipSvc));c("och",l=>l.checkedObjectiveIds,t),p("omt",l=>l.maximizeType),u("osm",l=>l.surplusMachinesOutput),p("odr",l=>l.displayRate),c("iex",l=>l.excludedItemIds,n.itemIds,r.items),c("ich",l=>l.checkedItemIds,n.itemIds,r.items),h("ibe",l=>l.beltId,r.belts),h("ipi",l=>l.pipeId,r.belts),h("icw",l=>l.cargoWagonId,r.wagons),h("ifw",l=>l.fluidWagonId,r.wagons),f("ifr",l=>l.flowRate),c("rex",l=>l.excludedRecipeIds,n.recipeIds,r.recipes),c("rch",l=>l.checkedRecipeIds,n.recipeIds,r.recipes),u("rnp",l=>l.netProductionOnly),p("mpr",l=>l.preset),m("mmr",l=>l.machineRankIds,r.machines),m("mfr",l=>l.fuelRankIds,r.fuels),m("mer",l=>l.moduleRankIds,r.modules),w("mbe",l=>l===s?void 0:e.beacons),f("moc",l=>l.overclock),f("mbr",l=>l.beaconReceivers),h("mps",l=>l.proliferatorSprayId,r.modules),p("mit",l=>l.inserterTarget),f("bmi",l=>l.miningBonus),f("bre",l=>l.researchBonus),p("bic",l=>l.inserterCapacity),c("tre",l=>l.researchedTechnologyIds,n.technologyIds,r.technologies),f("cfa",l=>l.costs.factor),f("cma",l=>l.costs.machine),f("cfp",l=>l.costs.footprint),f("cun",l=>l.costs.unproduceable),f("cex",l=>l.costs.excluded),f("csu",l=>l.costs.surplus),f("cmx",l=>l.costs.maximize)}unzipSettings(e,i,t,n,r,s,o){let c=this.zipSvc.get(i),p=c(this.zipSvc.parseSubset.bind(this.zipSvc)),u=c(this.zipSvc.parseNumber.bind(this.zipSvc)),h=c(this.zipSvc.parseBool.bind(this.zipSvc)),f=c(this.zipSvc.parseString.bind(this.zipSvc)),m=c(this.zipSvc.parseRational.bind(this.zipSvc)),w=c(this.zipSvc.parseArray.bind(this.zipSvc)),l=c(this.zipSvc.parseIndices.bind(this.zipSvc)),j={modId:e,checkedObjectiveIds:p("och",n),maximizeType:u("omt"),surplusMachinesOutput:h("osm"),displayRate:u("odr"),excludedItemIds:p("iex",s.items),checkedItemIds:p("ich",s.items),beltId:f("ibe",o?.belts),pipeId:f("ipi",o?.belts),cargoWagonId:f("icw",o?.wagons),fluidWagonId:f("ifw",o?.wagons),flowRate:m("ifr"),excludedRecipeIds:p("rex",s.recipes),checkedRecipeIds:p("rch",s.recipes),netProductionOnly:h("rnp"),preset:u("mpr"),machineRankIds:w("mmr",o?.machines),fuelRankIds:w("mfr",o?.fuels),moduleRankIds:w("mer",o?.modules),beacons:l("mbe",t),overclock:m("moc"),beaconReceivers:m("mbr"),proliferatorSprayId:f("mps",o?.modules),inserterTarget:u("mit"),miningBonus:m("bmi"),researchBonus:m("bre"),inserterCapacity:u("bic"),researchedTechnologyIds:p("tre",s.technologies)},B={factor:m("cfa"),machine:m("cma"),footprint:m("cfp"),unproduceable:m("cun"),excluded:m("cex"),surplus:m("csu"),maximize:m("cmx")},k=this.migrationSvc.parseSet.bind(this.migrationSvc);if(i.v10iex&&(j.excludedItemIds=k(i.v10iex,o?.items)),i.v10ich&&(j.checkedItemIds=k(i.v10ich,o?.items)),i.v10rex&&(j.excludedRecipeIds=k(i.v10rex,o?.recipes)),i.v10rch&&(j.checkedRecipeIds=k(i.v10rch,o?.recipes)),i.v10tre&&(j.researchedTechnologyIds=k(i.v10tre,o?.technologies),j.researchedTechnologyIds=this.migrationSvc.restoreV10ResearchedTechnologies(j.researchedTechnologyIds,r)),N(B),Object.keys(B).length&&(j.costs=B),N(j),!!Object.keys(j).length)return j}};S.\u0275fac=function(i){return new(i||S)},S.\u0275prov=T({token:S,factory:S.\u0275fac,providedIn:"root"});let d=S;return d})();export{Ye as a,Zi as b};
